# keepalive-zookeeper

封装zookeeper链接，简化相关操作和提高稳定性

## install

```
npm i @dp/keepalive-zookeeper@1.x --save
```

## Usage

```javascript
const ZK = require('@dp/keepalive-zookeeper')

let zk = new ZK()

// 初始化链接
yield zk.init()

// 获取值
let value = yield zk.getData('somepath')

```

## API

除constructor以外的API均返回`Promise` , API中的return值为promise的resolve值

### constructor(zkAddress)

- {string} [zkAddress] , zookeeper服务器列表,默认值为`appenv`中的配置值


### init()

初始化zookeeper ， 在实例化后调用此方法


### getAndWatch(path,onChange)

获取zookeeper中的值，并且添加监听函数

- {string} path , 节点路径
- {function} [onChange] , 节点[创建,删除,修改]时被触发，此函数接收一个对象:

    - {string} event , 事件类型:`'NODE_DELETED', 'NODE_DATA_CHANGED', 'NODE_CREATED'`
    - {string} data , 节点的最新值，被删除时返回null

- return {string} , 返回节点的值,如果不存在则为null

### getData(path)

获取指定节点的值

- {string} path , 节点路径
- return {string} , 节点的值，不存在时返回null
