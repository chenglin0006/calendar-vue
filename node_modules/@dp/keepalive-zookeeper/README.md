# keepalive-zookeeper

封装zookeeper链接，简化相关操作和提高稳定性

## requirement

Node >= 8
老版本node请使用[v1版本](./README.v1.md)

## install

```
npm i @dp/keepalive-zookeeper --save
```

## Usage

```javascript
const ZK = require('@dp/keepalive-zookeeper')

let zk = new ZK()

// 初始化链接
await zk.init()

// 获取值
let value = await zk.getData('somepath')

```

## API

### constructor(zkAddress)

- {string} [zkAddress] , zookeeper服务器列表,默认值为`appenv`中的配置值


### async init()

初始化zookeeper ， 在实例化后调用此方法


### async getAndWatch(path,onChange)

获取zookeeper中的值，并且添加监听函数

- {string} path , 节点路径
- {function} [onChange] , 节点[创建,删除,修改]时被触发，此函数接收一个对象:

    - {string} event , 事件类型:`'NODE_DELETED', 'NODE_DATA_CHANGED', 'NODE_CREATED'`
    - {string} data , 节点的最新值，被删除时返回null

- return {string} , 返回节点的值,如果不存在则为null


### async existsAndWatch(path,onChange)

判断zookeeper中指定节点是否存在，并且添加监听函数

- {string} path , 节点路径
- {function} [onChange] , 节点被[创建,删除]时触发，此函数接受一个对象参数:

    - {string} event , 事件类型:`'NODE_DELETED', 'NODE_CREATED'`
    - {boolean} data , 是否存在

- return {boolean} , 返回布尔值，节点是否存在

### async getData(path)

获取指定节点的值

- {string} path , 节点路径
- return {string} , 节点的值，不存在时返回null

### async exists(path)

判断指定节点是否存在

- {string} path , 节点路径
- return {boolean} , 返回布尔值，节点是否存在
